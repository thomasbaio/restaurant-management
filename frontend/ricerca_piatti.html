<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Search for dishes</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" type="image/png" href="images/logo.png">
</head>
<body>
  <h1>Search for dishes</h1>
  <h2>Perfect for you</h2>

  <!-- messaggio utente -->
  <div id="user-info" style="margin-bottom:20px;">
    <!-- visibile solo ai CLIENTI -->
    <a href="edit.html" data-client-only id="link-edit-dish" hidden>Edit dish</a>
  </div>

  <label> Name: <input type="text" id="nome"></label><br>
  <label> Typology: <input type="text" id="tipologia"></label><br>
  <label> Maximum price: <input type="number" id="prezzo" step="0.01"></label><br><br>

  <button onclick="cercaPiatti()">Search</button>

  <p><a href="index.html">Back to homepage</a></p>

  <h2>Results</h2>
  <ul id="risultati-piatti"></ul>

  <script src="js/ricerca_piatti.js?v=5" defer></script>

  <script>
    (function enforceClientOnly() {
      const user = JSON.parse(localStorage.getItem("loggedUser") || "null");
      const isCustomer = !!user && user.role === "cliente";
      const info = document.getElementById("user-info");
      const editLink = document.getElementById("link-edit-dish");

      if (isCustomer) {
        // Mostra link edit SOLO ai clienti
        if (editLink) editLink.hidden = false;
        info.innerHTML = `
          <a href="edit.html" id="link-edit-dish-2">Edit dish</a> |
          <a href="login.html" onclick="localStorage.removeItem('loggedUser')">Logout</a>
        `;
      } else {
        // Nessun link a edit.html per ospiti o ristoratori
        if (editLink) {
          editLink.hidden = true;
          editLink.addEventListener("click", (e) => { e.preventDefault(); return false; });
        }
        info.innerHTML = `
          <a href="login.html">Login</a> |
          <a href="register.html">Register</a>
        `;
      }

      // Difesa in profonditÃ : disabilita qualsiasi link con data-client-only se non cliente
      document.querySelectorAll("[data-client-only]").forEach(a => {
        if (!isCustomer) {
          a.hidden = true;
          a.addEventListener("click", (e) => { e.preventDefault(); return false; });
        } else {
          a.hidden = false;
        }
      });
    })();

    function logout() {
      localStorage.removeItem("loggedUser");
      window.location.reload();
    }
  </script>
</body>
</html>

